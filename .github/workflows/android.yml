- name: Set up JDK 17
  uses: actions/setup-java@v4
  with:
    distribution: temurin
    java-version: "17"
    cache: gradle

- name: Set up Android SDK
  uses: android-actions/setup-android@v3

- name: Accept SDK licenses (quiet)
  shell: bash
  run: |
    set -o pipefail
    yes | sdkmanager --licenses > /dev/null
    if [[ ${PIPESTATUS[1]} -ne 0 ]]; then
      echo "sdkmanager --licenses failed"; exit 1
    fi

- name: Install SDK components
  run: |
    sdkmanager "platform-tools" "platforms;android-34" "build-tools;34.0.0"

- name: Make gradlew executable
  run: chmod +x gradlew

- name: Assemble Debug
  run: ./gradlew --no-daemon clean :app:assembleDebug

- name: Upload debug APK
  uses: actions/upload-artifact@v4
  with:
    name: app-debug-${{ github.sha }}
    path: app/build/outputs/apk/debug/*.apk
    if-no-files-found: error
